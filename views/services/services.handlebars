<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">{{localize 'breadcrumbs.home'}}</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ PAGE_TITLE }}</li>
    </ol>
</nav>

<section class="bg-gray">

    <form class="filter">
        <div class="row">
            <div class="col-sm-9">
                <label class="custom-control custom-checkbox">
                    <input type="checkbox" name="filter[insurance]" class="custom-control-input" {{#if filter.insurance }}checked{{/if}}>
                    <span class="custom-control-indicator"></span>
                    <span class="custom-control-description">{{localize 'filters.covered'}}</span>
                </label>
            </div>
            <!--/.col-->
            <div class="col-sm-3">
                <button type="button" id="btn-more" class="btn btn-secondary collapsed filter-button" data-toggle="collapse" data-target="#moreFilters" aria-expanded="false"><i class="fas fa-angle-down"></i> {{localize 'filters.more'}}</button>
                <button type="submit" id="btn-more" class="btn btn-primary filter-button">{{localize 'filters.apply'}}</button>
            </div>
            <!--/.col-->
        </div>
        <!--/.row-->

        <div class="collapse" id="moreFilters" aria-expanded="true" style="">
            <hr>
            <div class="row">
                <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                    <h3>{{localize 'filters.location'}}</h3>
                    <label class="custom-control custom-radio">
                        <input id="locationRadio1" name="filter[city]" value="home" type="radio" class="custom-control-input" {{#if (equals filter.city 'home') }}checked{{/if}}>
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description">{{localize 'filters.yourCity'}}</span>
                    </label>
                    <label class="custom-control custom-radio">
                        <input id="locationRadio2" name="filter[city]" value="worldwide" type="radio" class="custom-control-input" {{#if (equals filter.city 'worldwide') }}checked{{/if}}>
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description">{{localize 'filters.worldwide'}}</span>
                    </label>
                </div>
                <!--/.col-->
                <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">

                    <h3>{{localize 'filters.maxPrice'}}: <span id="maxPriceLabel">{{filter.maxPrice}}</span> MPT</h3>

                    <input class="justify" type="range" min="0" max="100" id="maxPriceRange" name="filter[maxPrice]"
                        value="{{filter.maxPrice}}">
                    <script>
                        var slider = document.getElementById("maxPriceRange");
                        var output = document.getElementById("maxPriceLabel");
                        output.innerHTML = slider.value;

                        slider.oninput = function () {
                            output.innerHTML = this.value;
                        }
                    </script>

                </div>
                <!--/.col-->
            </div>
            <!--/.row-->
        </div>
        <!--/.collapse-->

    </form>

</section>

<div class="row">

    <div class="col-xl-4 push-xl-8 col-lg-12 push-lg-0">

        <nav class="sticky-top">
            <div id="map" class="map" style="height:400px">
            </div>
            <!--/.map-->

            <script>
                var locations = {{{jsonify hospitals}}}
                var avgCoordinates = {{{ jsonify avgCoordinates}}}

                function initLocationsMap() {
                    var center = avgCoordinates || {
                        lat: 39.529,
                        lng: -101.369
                    };

                    if (locations.length === 1) {
                        center.lat = locations[0].coordinations.lat;
                        center.lng = locations[0].coordinations.lng;
                    }
                    var map = new google.maps.Map(
                        document.getElementById('map'), {
                            center: center,
                            zoom: 3
                        }
                    );


                    var infowindow = new google.maps.InfoWindow({
                        content: ''
                    });

                    for (var i = 0, length = locations.length; i < length; i++) {
                        var hospital = locations[i];
                        var marker = new google.maps.Marker({
                            position: {
                                lat: hospital.coordinations.lat,
                                lng: hospital.coordinations.lng
                            },
                            title: hospital.name,
                            map: map,
                        });

                        google.maps.event.addListener(marker, 'click', (function (marker, content, infowindow) {
                            return function () {
                                infowindow.setContent(content);
                                infowindow.open(map, marker);
                            };
                        })(marker, getInfoWindowContent(hospital), infowindow));
                    }
                }

                function getInfoWindowContent(hospital) {
                    return '<div class="info-window">' +
                        '<h5>' + (hospital.name || '') + '</h5>' +
                        '<i>' + (hospital.address || '') + '</i><br/>' +
                        '<b>Provides <a href="/services/' + hospital.service.id + '">' + hospital.service.name +
                        '</b><br/>' +
                        '<a href="/clinics/' + hospital.id.toString() + '">View Clinic</a>'
                    '</div>';
                }
            </script>
            <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA839hvZlHkWX80W6YRTuv3C7HToNVZhwc&callback=initLocationsMap">
            </script>
        </nav>
    </div>
    <!--/.col-->

    <div class="col-xl-8 pull-xl-4 col-lg-12 pull-lg-0">
        <h3>Departments</h3>

        <ul class="nav-pills">
            <li class="nav-link active"><a href="#">All</a></li>
            <li class="nav-link"><a href="#">Allergology and Immunology</a> <span class="badge">0</span></li>
            <li class="nav-link"><a href="#">Pharmacy</a> <span class="badge">0</span></li>
            <li class="nav-link"><a href="#">Vaccination</a> <span class="badge">0</span></li>
            <li class="nav-link"><a href="#">Rehabilitation treatment</a> <span class="badge">0</span></li>
            <li class="nav-link"><a href="#">Gastroenterology</a> <span class="badge">0</span></li>
            <li class="nav-link"><a href="#">Gynecology and Obstetrics</a> <span class="badge">0</span></li>
            <li class="nav-link"><a href="#">Children's clinic</a> <span class="badge">0</span></li>
            <li class="nav-link"><a href="#">Dermatovenereology</a> <span class="badge">0</span></li>
            <li class="nav-link"><a href="#">Diagnosis and analysis</a> <span class="badge">0</span></li>
            <li class="nav-link"><a href="#">Cosmetology</a> <span class="badge">0</span></li>
            <li class="nav-link"><a href="#">Cardiology</a> <span class="badge">0</span></li>
            <li class="nav-link"><a href="#">Laboratory diagnostics</a> <span class="badge">0</span></li>
            <li class="nav-link"><a href="#">Coloproctology</a> <span class="badge">0</span></li>
            <li class="nav-link"><a href="#">Ophthalmology</a> <span class="badge">0</span></li>
        </ul>

        <div class="table-responsive services-table">
            <table summary="" class="table table-hover">
                <thead>
                    <tr>
                        <th width="40%">
                            <h5>{{localize 'service.table.service'}}</h5>
                        </th>
                        <th>
                            <h5>{{localize 'service.table.time'}}</h5>
                        </th>
                        <th>
                            <h5>{{localize 'service.table.price'}}</h5>
                        </th>
                        <th>
                            <h5>{{localize 'service.table.insurance'}}</h5>
                        </th>
                        <th class="text-right">
                            <h5>{{localize 'service.table.providers'}}</h5>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {{#each services as |service|}}
                    <tr>
                        <td>
                            <h4><a href="/services/{{ service.id }}" title="{{ service.name }}">{{ service.name }}</a></h4>
                            <p>{{ service.short_descr }}</p>
                            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
                                incididunt ut labore et dolore magna aliqua.</p>
                        </td>
                        <td>{{ service.time }}</td>
                        <td class="price-td">{{localize 'common.fromPrice'}} <strong class="text-dark">${{
                                service.price.dollars }}</strong><br /><strong class="text-success">{{
                                service.price.mpts }} MPT</strong></td>
                        <td class="text-center">
                            {{#if service.is_covered_by_insurance}}
                            <i class="fas fa-plus text-success" data-toggle="tooltip" data-placement="top" title="{{localize 'filters.covered'}}"></i>
                            {{/if}}
                        </td>
                        <td>
                            <a class="btn btn-primary float-right" href="/doctors?service={{service.id}}"><strong>{{defaultIfEmpty
                                    service.providers.doctors.length 0}}</strong> {{localize 'ratings.items.doctors'}}</a>
                            <br /><br />
                            <a class="btn btn-secondary float-right" href="/clinics?service={{service.id}}"><strong>{{defaultIfEmpty
                                    service.providers.hospitals.length 0}}</strong> {{localize
                                'ratings.items.clinics'}}</a>
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>
        <!--end of .table-responsive-->
    </div>
    <!--/.col-->
    <div class="row pagination-line pager">
        <div class="col">
            <nav aria-label="...">
                {{> pager pagerInfo }}
            </nav>
        </div>
    </div>
</div>
<!--/.row-->
